<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>企业微信二维码自动化工具</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>企业微信二维码自动化工具</h1>
            <nav class="nav-tabs">
                <button id="mainTab" class="tab-btn active">主页</button>
                <button id="historyTab" class="tab-btn">历史任务</button>
                <button id="groupReplaceTab" class="tab-btn">群码替换</button>
                <button id="configTab" class="tab-btn">环境配置</button>
            </nav>
        </header>
        
        <main>
            <!-- 主功能页面 -->
            <div id="mainPanel" class="tab-content active">
                <div id="progressPanel" class="progress-panel" style="display: none;">
                    <h3>安装进度</h3>
                    <div class="progress-bar">
                        <div id="progressBar" class="progress-fill"></div>
                    </div>
                    <div id="progressText" class="progress-text">0%</div>
                </div>
                
                <!-- 门店信息表单 -->
                <div class="store-form-panel">
                    <h3>门店信息</h3>
                    <form id="storeForm" class="store-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="storeName">门店名称 *</label>
                                <input type="text" id="storeName" name="storeName" required placeholder="请输入门店名称">
                            </div>
                            <div class="form-group">
                                <label for="mobile">手机号 *</label>
                                <input type="tel" id="mobile" name="mobile" pattern="[0-9]{11}" required placeholder="请输入11位手机号码">
                                <small class="form-text">请输入11位手机号码</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="storeType">门店类型 *</label>
                                <select id="storeType" name="storeType" required>
                                    <option value="">请选择门店类型</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="assistant">小助理 *</label>
                                <select id="assistant" name="assistant" required>
                                    <option value="">请选择小助理</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="weibanAssistant">微伴活码承接人</label>
                                <select id="weibanAssistant" name="weibanAssistant">
                                    <option value="">请选择微伴承接人（选填）</option>
                                </select>
                                <small class="form-text">选填，用于微伴活码创建时的成员名称，不填则使用小助理</small>
                            </div>
                        </div>
                        
                        <!-- 操作按钮区域 -->
                        <div class="form-actions">
                            <button type="button" id="executeBtn" class="btn btn-primary" disabled>
                                <span class="btn-icon">▶</span>
                                <span class="btn-text">执行任务</span>
                            </button>
                            <button type="button" id="stopBtn" class="btn btn-danger" disabled>
                                <span class="btn-icon">⏹</span>
                                <span class="btn-text">停止执行</span>
                            </button>
                            <button id="installBtn" class="btn btn-install" style="display: none;">安装Chromium</button>
                        </div>
                    </form>
                </div>
                
                <!-- 任务执行面板 -->
                <div class="task-panel">
                    <div class="task-content">
                        <!-- 左侧：步骤清单 -->
                        <div class="steps-section">
                            <h3>执行步骤</h3>
                            <div class="steps-list">
                                <div class="step-item" data-step="1">
                                    <div class="step-icon">
                                        <span class="step-number">1</span>
                                        <span class="step-status pending">⏳</span>
                                    </div>
                                    <div class="step-content">
                                        <div class="step-title">检查企微登录状态</div>
                                        <div class="step-message">等待执行...</div>
                                    </div>
                                </div>
                                <div class="step-item" data-step="2">
                                    <div class="step-icon">
                                        <span class="step-number">2</span>
                                        <span class="step-status pending">⏳</span>
                                    </div>
                                    <div class="step-content">
                                        <div class="step-title">检查微伴登录状态</div>
                                        <div class="step-message">等待执行...</div>
                                    </div>
                                </div>
                                <div class="step-item" data-step="3">
                                    <div class="step-icon">
                                        <span class="step-number">3</span>
                                        <span class="step-status pending">⏳</span>
                                    </div>
                                    <div class="step-content">
                                        <div class="step-title">更改企微通讯录名称</div>
                                        <div class="step-message">等待执行...</div>
                                    </div>
                                </div>
                                <div class="step-item" data-step="4">
                                    <div class="step-icon">
                                        <span class="step-number">4</span>
                                        <span class="step-status pending">⏳</span>
                                    </div>
                                    <div class="step-content">
                                        <div class="step-title">创建企业微信群码</div>
                                        <div class="step-message">等待执行...</div>
                                    </div>
                                </div>
                                <div class="step-item" data-step="5">
                                    <div class="step-icon">
                                        <span class="step-number">5</span>
                                        <span class="step-status pending">⏳</span>
                                    </div>
                                    <div class="step-content">
                                        <div class="step-title">创建微伴+v活码</div>
                                        <div class="step-message">等待执行...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 右侧：二维码展示 -->
                        <div class="qrcode-section">
                            <div class="qrcode-header">
                                <h3>生成的二维码</h3>
                                <button class="btn-folder" id="openQrCodeFolder" style="display: none;" title="打开文件夹">
                                    📁 打开文件夹
                                </button>
                            </div>
                            <div class="qrcode-grid">
                                <div class="qrcode-item" id="weworkQrCode">
                                    <div class="qrcode-header">
                                        <h4>企业微信群码</h4>
                                    </div>
                                    <div class="qrcode-preview">
                                        <div class="qrcode-placeholder">
                                            <span>二维码将在生成后显示</span>
                                        </div>
                                        <img id="weworkQrImage" style="display: none;" alt="企业微信群码">
                                    </div>
                                </div>
                                
                                <div class="qrcode-item" id="weibanQrCode">
                                    <div class="qrcode-header">
                                        <h4>微伴活码</h4>
                                    </div>
                                    <div class="qrcode-preview">
                                        <div class="qrcode-placeholder">
                                            <span>二维码将在生成后显示</span>
                                        </div>
                                        <img id="weibanQrImage" style="display: none;" alt="微伴活码">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="log-panel">
                    <div class="log-header">
                        <h3>操作日志</h3>
                        <div class="log-controls">
                            <button id="clearLogsBtn" class="btn btn-small">清空日志</button>
                            <button id="autoScrollBtn" class="btn btn-small active" data-auto-scroll="true">自动滚动</button>
                        </div>
                    </div>
                    <div id="logs" class="log-container"></div>
                </div>
            </div>

            <!-- 群码替换页面 -->
            <div id="groupReplacePanel" class="tab-content">
                <div class="group-replace-header">
                    <h2>群码替换功能</h2>
                    <p class="feature-description">自动搜索指定关键词的群组，并执行替换操作</p>
                </div>
                
                <div class="group-replace-content">
                    <form id="groupReplaceForm" class="group-replace-form">
                        <div class="form-section">
                            <h3>搜索参数</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="groupSearchKeyword">搜索关键词 *</label>
                                    <input type="text" id="groupSearchKeyword" name="searchKeyword" 
                                           value="LJYX" placeholder="请输入搜索关键词" required>
                                    <small class="form-text">搜索包含此关键词的群组进行替换操作</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" id="executeGroupReplaceBtn" class="btn btn-primary btn-large">
                                <span class="btn-icon">🚀</span>
                                <span class="btn-text">开始群码替换</span>
                            </button>
                            <button type="button" id="stopGroupReplaceBtn" class="btn btn-danger" disabled>
                                <span class="btn-icon">⏹</span>
                                <span class="btn-text">停止替换</span>
                            </button>
                        </div>
                    </form>
                    
                    <!-- 执行状态和日志 -->
                    <div class="log-panel">
                        <div class="log-header">
                            <h3>操作日志</h3>
                            <div class="log-controls">
                                <button id="clearGroupReplaceLogsBtn" class="btn btn-small">清空日志</button>
                                <button id="autoScrollGroupReplaceBtn" class="btn btn-small active" data-auto-scroll="true">自动滚动</button>
                            </div>
                        </div>
                        <div id="groupReplaceLogs" class="log-container">
                            <div class="log-placeholder">
                                <div class="placeholder-icon">📝</div>
                                <p>点击"开始群码替换"按钮执行任务，执行日志将在此显示</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 历史任务页面 -->
            <div id="historyPanel" class="tab-content">
                <div class="history-header">
                    <h2>历史任务记录</h2>
                    <div class="history-actions">
                        <button id="refreshHistoryBtn" class="btn btn-secondary">刷新</button>
                    </div>
                </div>
                
                <div class="history-content">
                    <div id="historyLoading" class="loading-spinner" style="display: none;">
                        <div class="spinner"></div>
                        <span>加载历史记录中...</span>
                    </div>
                    
                    <div id="historyList" class="history-list">
                        <!-- 历史任务记录将在这里动态生成 -->
                    </div>
                    
                    <div id="noHistoryMessage" class="no-history" style="display: none;">
                        <div class="no-history-icon">📭</div>
                        <h3>暂无历史任务记录</h3>
                        <p>完成第一个任务后，历史记录将在这里显示</p>
                    </div>
                </div>
            </div>

            <!-- 配置管理页面 -->
            <div id="configPanel" class="tab-content">
                <div class="config-header">
                    <h2>环境配置管理</h2>
                    <div class="config-actions">
                        <button id="saveConfigBtn" class="btn btn-primary">保存配置</button>
                    </div>
                </div>
                
                <form id="configForm" class="config-form">
                    <!-- 基本配置 -->
                    <div class="config-section">
                        <h3>基本配置</h3>
                        <div class="form-group">
                            <label for="appName">应用名称</label>
                            <input type="text" id="appName" name="APP_NAME" required>
                        </div>
                    </div>

                    <!-- 自动化配置 -->
                    <div class="config-section">
                        <h3>自动化配置</h3>
                        <div class="form-group">
                            <label for="weworkContactUrl">企业微信通讯录链接</label>
                            <input type="url" id="weworkContactUrl" name="WEWORK_CONTACT_URL" required>
                            <small class="form-text">企业微信通讯录页面的完整URL</small>
                        </div>
                        <div class="form-group">
                            <label for="weworkCreateGroupUrl">群活码创建链接</label>
                            <input type="url" id="weworkCreateGroupUrl" name="WEWORK_CREATE_GROUP_LIVE_CODE_URL" required>
                            <small class="form-text">企业微信群活码创建页面的完整URL</small>
                        </div>
                        <div class="form-group">
                            <label for="userDataDir">用户数据目录</label>
                            <input type="text" id="userDataDir" name="USER_DATA_DIR" required>
                            <small class="form-text">浏览器数据存储目录，支持~表示用户主目录</small>
                        </div>
                        <div class="form-group">
                            <label for="storeAvatarPath">门店头像路径</label>
                            <input type="text" id="storeAvatarPath" name="STORE_AVATAR_PATH" required>
                            <small class="form-text">门店头像文件的本地路径</small>
                        </div>
                        <div class="form-group">
                            <label for="qrCodeStorePath">二维码存储路径</label>
                            <input type="text" id="qrCodeStorePath" name="QRCODE_TARGET_STORE_PATH" required>
                            <small class="form-text">二维码文件的存储根目录</small>
                        </div>
                        <div class="form-group">
                            <label for="weibanDashboard">微伴首页链接</label>
                            <input type="url" id="weibanDashboard" name="WEIBAN_DASHBOARD_URL" required>
                            <small class="form-text">微伴助手首页的完整URL</small>
                        </div>
                        <div class="form-group">
                            <label for="weibanQrCreate">微伴活码创建链接</label>
                            <input type="url" id="weibanQrCreate" name="WEIBAN_QR_CREATE_URL" required>
                            <small class="form-text">微伴渠道活码创建页面的完整URL</small>
                        </div>
                        <div class="form-group">
                            <label for="weworkGroupManagementUrl">群聊管理链接</label>
                            <input type="url" id="weworkGroupManagementUrl" name="WEWORK_GROUP_MANAGEMENT_URL" required>
                            <small class="form-text">企业微信群聊管理页面的完整URL</small>
                        </div>
                        <div class="form-group">
                            <label for="weworkGroupMemberDeleteThreshold">群成员删除阈值</label>
                            <input type="number" id="weworkGroupMemberDeleteThreshold" name="WEWORK_GROUP_MEMBER_DELETE_THRESHOLD" value="100" min="1">
                            <small class="form-text">当群成员数量达到此阈值时，该群将被标记为删除并重新创建</small>
                        </div>
                    </div>

                    <!-- 消息模板配置 -->
                    <div class="config-section">
                        <h3>消息模板配置</h3>
                        <div class="form-group">
                            <label for="weibanWelcomeMsg">店中店欢迎语</label>
                            <textarea id="weibanWelcomeMsg" name="WEIBAN_WELCOME_MSG" rows="4" required></textarea>
                            <small class="form-text">支持{{storeName}}变量和\n换行符</small>
                        </div>
                        <div class="form-group">
                            <label for="weibanWelcomeMsgIndependent">独立店欢迎语</label>
                            <textarea id="weibanWelcomeMsgIndependent" name="WEIBAN_WELCOME_MSG_INDEPENDENT" rows="4" required></textarea>
                            <small class="form-text">支持{{storeName}}变量和\n换行符</small>
                        </div>
                    </div>

                    <!-- 用户数据配置 -->
                    <div class="config-section">
                        <h3>用户数据配置</h3>
                        <div class="form-group">
                            <label for="userMappings">可用助手名单</label>
                            <div class="list-input-container">
                                <div id="userMappingsList" class="list-items"></div>
                                <div class="list-input-row">
                                    <input type="text" id="newUserMapping" placeholder="输入助手名称">
                                    <button type="button" id="addUserMapping" class="btn btn-small">添加</button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="storeTypes">店铺类型选项</label>
                            <div class="list-input-container">
                                <div id="storeTypesList" class="list-items"></div>
                                <div class="list-input-row">
                                    <input type="text" id="newStoreType" placeholder="输入店铺类型">
                                    <button type="button" id="addStoreType" class="btn btn-small">添加</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </main>
    </div>
    
    <script src="renderer.js"></script>
</body>
</html>